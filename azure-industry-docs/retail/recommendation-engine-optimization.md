---
title: Použití doporučených systémů a algoritmů R s Azure
author: kbaroni
ms.author: kbaroni
ms.date: 11/20/2019
ms.topic: article
ms.service: industry
description: Postup opětovného použití a optimalizace aplikací s doporučeními napsaných v jazyce R Spoléhá Machine Learning Server na virtuální počítače Azure.
ms.openlocfilehash: c5c35de681abc52641952f8bc9e95095b9d99d97
ms.sourcegitcommit: 3b175d73a82160c4cacec1ce00c6d804a93c765d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/06/2020
ms.locfileid: "77054214"
---
# <a name="optimize-and-reuse-an-existing-recommendation-system"></a><span data-ttu-id="d0be7-104">Optimalizace a opakované použití stávajícího systému doporučení</span><span class="sxs-lookup"><span data-stu-id="d0be7-104">Optimize and reuse an existing recommendation system</span></span>  

<span data-ttu-id="d0be7-105">Tento dokument popisuje proces úspěšného použití a vylepšení stávajícího systému doporučení napsaného v jazyce R. Tento klíč byl paralelismus knihoven MicrosoftML a RevoScaleR integrovaných do Microsoft Machine Learning Server.</span><span class="sxs-lookup"><span data-stu-id="d0be7-105">This document describes the process of successfully reusing and improving an existing recommendation system written in R. The key to this was the parallelism of the MicrosoftML and RevoScaleR libraries built into Microsoft Machine Learning Server.</span></span>

## <a name="recommendation-systems-and-r"></a><span data-ttu-id="d0be7-106">Systémy doporučení a R</span><span class="sxs-lookup"><span data-stu-id="d0be7-106">Recommendation systems and R</span></span>

<span data-ttu-id="d0be7-107">V případě maloobchodního prodeje je porozumět zákaznickým požadavkům a historii nákupů výhod.</span><span class="sxs-lookup"><span data-stu-id="d0be7-107">For a retailer, understanding consumer preferences and purchasing history is a competitive advantage.</span></span> <span data-ttu-id="d0be7-108">Maloobchodní prodejci používají taková data pro roky v kombinaci se službou Machine Learning k identifikaci produktů relevantních pro daného příjemce a dodávají přizpůsobené možnosti nákupu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-108">Retailers have been using such data for years, in combination with machine learning, to identify products relevant to the consumer and deliver a personalized shopping experience.</span></span> <span data-ttu-id="d0be7-109">Tento přístup se nazývá **doporučení produktu** a generuje významný datový proud příjmů pro maloobchodníky.</span><span class="sxs-lookup"><span data-stu-id="d0be7-109">The approach is called **product recommendation** and it generates a significant revenue stream for retailers.</span></span> <span data-ttu-id="d0be7-110">Systémy pro doporučení, které vám pomůžou zodpovědět otázky: *Jaký film bude tato osoba sledovat další? S jakými dalšími službami je tento zákazník pravděpodobně zajímat? Kde bude tento zákazník chtít dovolenou?*</span><span class="sxs-lookup"><span data-stu-id="d0be7-110">Recommendation systems help answer questions like: *What movie will this person watch next? What additional services is this customer likely to be interested in? Where will this customer want to vacation?*</span></span>
<span data-ttu-id="d0be7-111">Nejnovější zákazník chtěl získat informace o tom, že *budou spotřebitelé (předplatitelé) obnovovat své smlouvy?*</span><span class="sxs-lookup"><span data-stu-id="d0be7-111">A recent customer wanted to know: *Will consumers (subscribers) renew their contracts?*</span></span> <span data-ttu-id="d0be7-112">Zákazník měl existující doporučený model, který by měl předpověď pravděpodobnosti, že předplatitele obnovuje kontrakt.</span><span class="sxs-lookup"><span data-stu-id="d0be7-112">The customer had an existing recommendation model that would forecast the probability of a subscriber renewing a contract.</span></span> <span data-ttu-id="d0be7-113">Po vygenerování prognózy se použilo další zpracování pro klasifikaci odpovědi na Ano, ne nebo možná.</span><span class="sxs-lookup"><span data-stu-id="d0be7-113">Once the forecast was generated, additional processing was applied to classify a response into a yes, no, or maybe.</span></span> <span data-ttu-id="d0be7-114">Odpověď modelu byla potom integrována do obchodního procesu služby Call Center.</span><span class="sxs-lookup"><span data-stu-id="d0be7-114">The model response was then integrated into a call center business process.</span></span> <span data-ttu-id="d0be7-115">Tento proces povolil agentovi služby poskytovat individuální doporučení pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-115">That process enabled a service agent to deliver a personalized recommendation to the consumer.</span></span>  
<span data-ttu-id="d0be7-116">Mnohé z dřívějších analytických produktů od tohoto zákazníka byly postaveny v [programovacím jazyce R](https://docs.microsoft.com/machine-learning-server/rebranding-microsoft-r-server), včetně modelu strojového učení, v jádru systému doporučení.</span><span class="sxs-lookup"><span data-stu-id="d0be7-116">Many of this customer’s early analytic products were built in the [programming language R](https://docs.microsoft.com/machine-learning-server/rebranding-microsoft-r-server), including the machine learning model at the core of their recommendation system.</span></span> <span data-ttu-id="d0be7-117">Vzhledem k tomu, že jejich základ předplatitele vzrostl, musí mít požadavky na data a výpočetní výkon.</span><span class="sxs-lookup"><span data-stu-id="d0be7-117">As their subscriber base has grown, so have the data and compute requirements.</span></span> <span data-ttu-id="d0be7-118">To znamená, že úlohy doporučení teď painfully pomalu a nenáročným způsobem.</span><span class="sxs-lookup"><span data-stu-id="d0be7-118">So much so, the recommendation workload is now painfully slow and cumbersome to process.</span></span> <span data-ttu-id="d0be7-119">V současnosti je Python stále součástí strategie analytického produktu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-119">Now Python is increasingly a part of their analytic product strategy.</span></span> <span data-ttu-id="d0be7-120">V blízké době ale musí zachovat investici R a najít efektivnější proces vývoje a nasazení.</span><span class="sxs-lookup"><span data-stu-id="d0be7-120">But for the near term, they need to preserve their R investment and find a more efficient development and deployment process.</span></span> <span data-ttu-id="d0be7-121">Výzvou bylo optimalizovat stávající přístup pomocí možností v Azure.</span><span class="sxs-lookup"><span data-stu-id="d0be7-121">The challenge was to optimize the existing approach using capabilities in Azure.</span></span> <span data-ttu-id="d0be7-122">Na úkol jsme se zavedli, abychom k tomu mohli poskytnout – a ověřit – technologický zásobník pro kontrolu konceptu pro úlohy s doporučeními.</span><span class="sxs-lookup"><span data-stu-id="d0be7-122">We embarked on a task to provide—and validate—a proof-of-concept technology stack for the recommendation workload.</span></span> <span data-ttu-id="d0be7-123">Tady shrnujeme obecný přístup, který je možné použít pro podobné projekty.</span><span class="sxs-lookup"><span data-stu-id="d0be7-123">Here we summarize a general approach that can be used for similar projects.</span></span>  

## <a name="design-goals"></a><span data-ttu-id="d0be7-124">Cíle návrhu</span><span class="sxs-lookup"><span data-stu-id="d0be7-124">Design goals</span></span>

<span data-ttu-id="d0be7-125">Klíčovou prioritou bylo přenavrhovat a automatizovat pracovní postup modelu, který poskytuje několik výhod:</span><span class="sxs-lookup"><span data-stu-id="d0be7-125">A key priority was to redesign and automate the model workflow to provide several advantages:</span></span>

- <span data-ttu-id="d0be7-126">Rychlejší vývojové cykly modelů a rychlejší inovace v čase.</span><span class="sxs-lookup"><span data-stu-id="d0be7-126">Faster model development cycles and faster time-to-innovate.</span></span> <span data-ttu-id="d0be7-127">Když jsou vývojové cykly pro přípravu a vývoj dat efektivní, může se objem experimentů zvýšit.</span><span class="sxs-lookup"><span data-stu-id="d0be7-127">When data preparation and model development cycles are efficient, the volume of experiments can increase.</span></span>  
- <span data-ttu-id="d0be7-128">Přesnější výsledky modelu a lepší doporučení prostřednictvím častých reškolicích cyklů pro nová data.</span><span class="sxs-lookup"><span data-stu-id="d0be7-128">More accurate model results and better recommendations through more frequent retraining cycles on fresh data.</span></span>
- <span data-ttu-id="d0be7-129">Lépe škálovatelná implementace ověření koncepce – ta, která by fungovala v plné produkci.</span><span class="sxs-lookup"><span data-stu-id="d0be7-129">A more scalable proof-of-concept (POC) implementation—one that would work in full production.</span></span>
- <span data-ttu-id="d0be7-130">Rychlejší doba provozu díky automatizaci procesů mezi vývojem, testováním a nasazením.</span><span class="sxs-lookup"><span data-stu-id="d0be7-130">Faster time to production by automating the processes between development, test, and deployment.</span></span> <span data-ttu-id="d0be7-131">Automatizace také snižuje provozní chyby a časy prodlevy.</span><span class="sxs-lookup"><span data-stu-id="d0be7-131">Automation also reduces operational errors and lag times.</span></span>  

## <a name="requirements"></a><span data-ttu-id="d0be7-132">Požadavky</span><span class="sxs-lookup"><span data-stu-id="d0be7-132">Requirements</span></span>

<span data-ttu-id="d0be7-133">Změna návrhu pracovního postupu má následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="d0be7-133">The workflow redesign had the following requirements:</span></span>

- <span data-ttu-id="d0be7-134">Využijte stávající dovednosti a znalosti v R týmu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-134">Leverage the team’s existing R skills and expertise.</span></span>
- <span data-ttu-id="d0be7-135">Znovu použijte kód, kde má smysl.</span><span class="sxs-lookup"><span data-stu-id="d0be7-135">Reuse code where it made sense.</span></span>
- <span data-ttu-id="d0be7-136">Ukládat data předplatitelů v databázi, aby bylo možné snadno a rychle integrovat do modelu školení a rekurze.</span><span class="sxs-lookup"><span data-stu-id="d0be7-136">Store subscriber data in a database to be easily and quickly integrated into the model training and retraining process.</span></span>
- <span data-ttu-id="d0be7-137">Vyvolejte přeškolení a bodování modelu prostřednictvím rozhraní webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-137">Invoke model retraining and scoring through a web app interface.</span></span>
- <span data-ttu-id="d0be7-138">Pro ověřování na front-endu webu použijte Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d0be7-138">Use Azure Active Directory for authentication on the web front end.</span></span>

## <a name="technology-stack"></a><span data-ttu-id="d0be7-139">Technologický zásobník</span><span class="sxs-lookup"><span data-stu-id="d0be7-139">Technology stack</span></span>

<span data-ttu-id="d0be7-140">Kanál pro tento projekt vyžadoval více technologií a nástrojů a Centrované kolem čtyř oblastí:</span><span class="sxs-lookup"><span data-stu-id="d0be7-140">The pipeline for this project required multiple technologies and tools and centered around four areas:</span></span>

1. <span data-ttu-id="d0be7-141">Stálost a přístupnost dat předplatitele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-141">Persistence and accessibility of subscriber data.</span></span>
2. <span data-ttu-id="d0be7-142">Vývoj, školení a výběr modelů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-142">Development, training, and selection of models.</span></span>  
3. <span data-ttu-id="d0be7-143">Nasazení modelu a provozní prostředí.</span><span class="sxs-lookup"><span data-stu-id="d0be7-143">Model deployment and operationalization.</span></span>
4. <span data-ttu-id="d0be7-144">Použití webové aplikace k vyvolání bodování a opětovného školení modelu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-144">Use of a web application to invoke scoring and model re-training.</span></span>

<span data-ttu-id="d0be7-145">Technologické komponenty v diagramu kanálu jsou podrobněji popsány níže.</span><span class="sxs-lookup"><span data-stu-id="d0be7-145">The technology components in the pipeline diagram are discussed in more detail below.</span></span>

![Architektura optimalizace](assets/recommendation-engine-optimization/recommendation-architecture.png)

### <a name="microsoft-machine-learning-server"></a><span data-ttu-id="d0be7-147">Server Microsoft Machine Learning</span><span class="sxs-lookup"><span data-stu-id="d0be7-147">Microsoft Machine Learning Server</span></span>

<span data-ttu-id="d0be7-148">Hlavní důvod pro výběr úloh R: **[RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler)** a **Microsoft ml**.</span><span class="sxs-lookup"><span data-stu-id="d0be7-148">The primary reason for selecting R workloads: **[RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler)** and **Microsoft ML**.</span></span> <span data-ttu-id="d0be7-149">Funkce, které jsou součástí těchto balíčků, se v celém kódu používaly k importu dat, vytvoření modelů klasifikace a jejich nasazení do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="d0be7-149">The functions included with these packages were used extensively throughout the code to import the data, create the classification models, and deploy them into production.</span></span>
<span data-ttu-id="d0be7-150">MLS bylo nasazeno na dva virtuální počítače se systémem Linux v Azure: jedna konfigurovaná pro vývoj a jedna konfigurovaná pro "operace".</span><span class="sxs-lookup"><span data-stu-id="d0be7-150">MLS was deployed on two Linux virtual machines in Azure: one configured for “development” and one configured for “operations.”</span></span> <span data-ttu-id="d0be7-151">Vývojový virtuální počítač byl zřízený s podstatně větší pamětí a výkonem, aby se usnadnilo školení a testování stovek modelů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-151">The development VM was provisioned with significantly more memory and processing power to facilitate the training and testing of hundreds of models.</span></span> <span data-ttu-id="d0be7-152">Také hostovaný RStudio Server, který poskytuje snadný přístup k IDE RStudio pro vzdálené uživatele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-152">It also hosted RStudio Server to provide easy access to an RStudio IDE for remote users.</span></span> <span data-ttu-id="d0be7-153">Provozní server byl nakonfigurován na menším virtuálním počítači s dalšími rozšířeními nezbytnými pro hostování modelů R, které byly volat z webové aplikace prostřednictvím rozhraní REST API.</span><span class="sxs-lookup"><span data-stu-id="d0be7-153">The operations server was configured on a smaller VM with the additional extensions necessary to host R models that were callable from a web application through REST APIs.</span></span>

### <a name="rstudio-server"></a><span data-ttu-id="d0be7-154">RStudio Server</span><span class="sxs-lookup"><span data-stu-id="d0be7-154">RStudio Server</span></span>

<span data-ttu-id="d0be7-155">**[RStudio Server](https://www.rstudio.com/products/rstudio/#Server)** je aplikace pro Linux, která poskytuje rozhraní založené na prohlížeči pro vzdálené nebo přenosné klienty.</span><span class="sxs-lookup"><span data-stu-id="d0be7-155">**[RStudio Server](https://www.rstudio.com/products/rstudio/#Server)** is a Linux application that provides a browser-based interface for remote or laptop clients.</span></span> <span data-ttu-id="d0be7-156">Běží na portu 8787 a je k dispozici pro vzdálená připojení, jakmile se na virtuálním počítači Azure vytvoří pravidlo zabezpečení sítě.</span><span class="sxs-lookup"><span data-stu-id="d0be7-156">It runs on port 8787 and is available to remote connections once a network security rule is created on the Azure VM.</span></span> <span data-ttu-id="d0be7-157">Pro analytiky a odborníky přes data, kteří preferují RStudio IDE, může být efektivní možností pro poskytování přístupu k virtuálnímu počítači s velkou výpočetní kapacitou a kapacitou paměti.</span><span class="sxs-lookup"><span data-stu-id="d0be7-157">For analysts and data scientists who prefer the RStudio IDE, it can be an efficient option for providing access to virtual machine with a large compute and memory capacity.</span></span> <span data-ttu-id="d0be7-158">Je k dispozici ke stažení ve zdrojové i komerční edici.</span><span class="sxs-lookup"><span data-stu-id="d0be7-158">It is available for download in both source and commercial editions.</span></span>

### <a name="azure-sql-database"></a><span data-ttu-id="d0be7-159">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="d0be7-159">Azure SQL Database</span></span>

<span data-ttu-id="d0be7-160">Data předplatitele byla původně uložena v jednom velmi velkém souboru. csv s 6 000 000 řádky informací o nákupu a preferencích pro jedinečné předplatitele 500.</span><span class="sxs-lookup"><span data-stu-id="d0be7-160">Originally, the subscriber data was stored in one very large .csv file with 6 million rows of purchasing and preference information for 500 unique subscribers.</span></span> <span data-ttu-id="d0be7-161">Uložení dat v databázi znamená rychlejší přístup k datům v jazyce R a umožňuje filtrovaných čtení.</span><span class="sxs-lookup"><span data-stu-id="d0be7-161">Storing the data in a database meant faster data access from within R and it would allow for filtered reads.</span></span> <span data-ttu-id="d0be7-162">Už nemusíte naimportovat celou datovou sadu pro školení nebo rekurzování: data se filtrují předplatitelem ve zdroji databáze, což významně snižuje prostředky potřebné k importu a zpracování dat.</span><span class="sxs-lookup"><span data-stu-id="d0be7-162">No longer would the entire data set need to be imported for training or retraining: data would be filtered by subscriber at the database source, significantly reducing the resources needed to import and process the data.</span></span>  
<span data-ttu-id="d0be7-163">V Azure je několik možností spravovaných cloudových databází.</span><span class="sxs-lookup"><span data-stu-id="d0be7-163">There are several managed cloud database options in Azure.</span></span> <span data-ttu-id="d0be7-164">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/) byla vybrána z důvodu znalosti zákazníka s SQL Server a – důležitější je, v budoucích plánech zavést SQL Server Machine Learning Services na širší škálu Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="d0be7-164">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/) was selected because of the customer’s familiarity with SQL Server and—more importantly—future plans to introduce SQL Server Machine Learning Services on a broader scale to Azure SQL Database.</span></span> <span data-ttu-id="d0be7-165">[SQL Server Machine Learning Services](https://docs.microsoft.com/sql/advanced-analytics/what-is-sql-server-machine-learning?view=sql-server-2017) jsou funkce v databázi pro provádění úloh R a Python prostřednictvím uložených procedur.</span><span class="sxs-lookup"><span data-stu-id="d0be7-165">[SQL Server Machine Learning Services](https://docs.microsoft.com/sql/advanced-analytics/what-is-sql-server-machine-learning?view=sql-server-2017) are in-database capabilities for executing R and Python workloads via stored procedures.</span></span>

### <a name="nodejs-and-reactjs"></a><span data-ttu-id="d0be7-166">Node. js a reagovat. js</span><span class="sxs-lookup"><span data-stu-id="d0be7-166">Node.js and React.js</span></span>

<span data-ttu-id="d0be7-167">Webové rozhraní bylo vytvořeno za účelem vyvolání skriptů jazyka R a zabezpečení webu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-167">A web interface was created to invoke R scripts and secure the website.</span></span> <span data-ttu-id="d0be7-168">Bylo vybráno Node. js jako rozhraní webového serveru, protože umožňuje pro webové aplikace v distribuovaném prostředí lehký a efektivní běhové prostředí.</span><span class="sxs-lookup"><span data-stu-id="d0be7-168">Node.js was selected as the web server framework because it enables a light-weight and efficient runtime environment for web applications within a distributed environment.</span></span> <span data-ttu-id="d0be7-169">Reakce se používá k sestavení uživatelských rozhraní a zastavování na front-endu a volá webové služby hostované na webovém serveru.</span><span class="sxs-lookup"><span data-stu-id="d0be7-169">React is used to build user interfaces and sits on the front end and calls web services hosted on the web server.</span></span> <span data-ttu-id="d0be7-170">Zjistilo se, že uzel + reakce by poskytoval nejrychlejší cestu pro webové služby pro kanál modelu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-170">It was believed Node + React would provide the quickest path for proto-typing web services for the model pipeline.</span></span>  

## <a name="infrastructure-implementation"></a><span data-ttu-id="d0be7-171">Implementace infrastruktury</span><span class="sxs-lookup"><span data-stu-id="d0be7-171">Infrastructure implementation</span></span>

<span data-ttu-id="d0be7-172">Níže uvedené části popisují, jak byla infrastruktura serveru pro tento projekt nasazena.</span><span class="sxs-lookup"><span data-stu-id="d0be7-172">The sections below describe how the server infrastructure was deployed for this project.</span></span> <span data-ttu-id="d0be7-173">Získání správné infrastruktury pro vývoj a nasazení může být důležité jako určení způsobu modelování a postupů, které se použijí.</span><span class="sxs-lookup"><span data-stu-id="d0be7-173">Getting the right development and deployment infrastructure can be as essential as determining the modeling approach and techniques that will be applied.</span></span>

### <a name="initial-database-load"></a><span data-ttu-id="d0be7-174">Počáteční načtení databáze</span><span class="sxs-lookup"><span data-stu-id="d0be7-174">Initial Database Load</span></span>

<span data-ttu-id="d0be7-175">Prvním krokem bylo importovat data předplatitelů z velmi velkého souboru. CSV do Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="d0be7-175">The first step was to import the subscriber data from a very large .csv file into Azure SQL Database.</span></span> <span data-ttu-id="d0be7-176">K dispozici je více možností pro import dat do Azure SQL Database popsaných v tomto [odkazu](https://blogs.msdn.microsoft.com/sqlcat/2010/07/30/loading-data-to-sql-azure-the-fast-way/).</span><span class="sxs-lookup"><span data-stu-id="d0be7-176">There are multiple options for importing data into Azure SQL Database described in in this [reference](https://blogs.msdn.microsoft.com/sqlcat/2010/07/30/loading-data-to-sql-azure-the-fast-way/).</span></span> <span data-ttu-id="d0be7-177">Tady je postup:</span><span class="sxs-lookup"><span data-stu-id="d0be7-177">Here is how we did it:</span></span>

1. <span data-ttu-id="d0be7-178">Databázi jste vytvořili Azure Portal [následujícím postupem.](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal)</span><span class="sxs-lookup"><span data-stu-id="d0be7-178">Created the database through Azure portal following steps [here](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal).</span></span>
2. <span data-ttu-id="d0be7-179">Pro připojení k databázi z virtuálního počítače se stáhla a použila [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) .</span><span class="sxs-lookup"><span data-stu-id="d0be7-179">Downloaded and used [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) to connect to the database from the VM.</span></span>
3. <span data-ttu-id="d0be7-180">Vybrali jste [Průvodce importem/exportem SQL](https://docs.microsoft.com/sql/integration-services/import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard?view=sql-server-2017) (Pokud jste časově omezili více možností pro import dat).</span><span class="sxs-lookup"><span data-stu-id="d0be7-180">Selected the [SQL Import/Export Wizard](https://docs.microsoft.com/sql/integration-services/import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard?view=sql-server-2017) (if you are time-constrained, there are more performant data import options).</span></span> <span data-ttu-id="d0be7-181">Mějte na paměti, že Průvodce importem a exportem mapuje datové typy ze zdroje dat do cílového cíle; a v našem scénáři byly všechny datové prvky namapovány na datový typ varchar (max), který byl přijatelný.</span><span class="sxs-lookup"><span data-stu-id="d0be7-181">Keep in mind the import/export wizard maps datatypes from the data source to the target destination; and with our scenario, all data elements were mapped to a varchar(max) data type which was acceptable.</span></span> <span data-ttu-id="d0be7-182">Pokud váš scénář vyžaduje jiné mapování, můžete upravit typy DataTypes v průvodci ([odkaz](https://docs.microsoft.com/sql/integration-services/import-export-data/data-type-mapping-in-the-sql-server-import-and-export-wizard?view=sql-server-2017)).</span><span class="sxs-lookup"><span data-stu-id="d0be7-182">If your scenario requires different mappings, you can modify the datatypes in the wizard ([reference](https://docs.microsoft.com/sql/integration-services/import-export-data/data-type-mapping-in-the-sql-server-import-and-export-wizard?view=sql-server-2017)).</span></span>  
4. <span data-ttu-id="d0be7-183">Vzhledem k tomu, že většina dotazů odeslaných do databáze filtru *subscriber_id*, vytvořili jsme pro toto pole index.</span><span class="sxs-lookup"><span data-stu-id="d0be7-183">Since most queries submitted to the database would filter on the field *subscriber_id*, we created an index on that field.</span></span>

### <a name="web-application"></a><span data-ttu-id="d0be7-184">Webová aplikace</span><span class="sxs-lookup"><span data-stu-id="d0be7-184">Web application</span></span>

<span data-ttu-id="d0be7-185">Webová aplikace zodpovídá za tři funkce:</span><span class="sxs-lookup"><span data-stu-id="d0be7-185">The web application is responsible for three functions:</span></span>

- <span data-ttu-id="d0be7-186">Ověřování: uživatelé webu ověřují před *Azure Active Directory* prostřednictvím *reagující* front-endu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-186">Authentication: web users authenticate against *Azure Active Directory* through the *React* front end.</span></span>
- <span data-ttu-id="d0be7-187">Bodování modelu: přijímá vstupní data od uživatele pro konkrétního předplatitele, odesílá data předplatitele webové službě pomocí REST API, která vrací odpověď předpovědi.</span><span class="sxs-lookup"><span data-stu-id="d0be7-187">Model scoring: accepts input data from the user for a specific subscriber, submits the subscriber data to the web service using the REST API, which returns a prediction response.</span></span>  
- <span data-ttu-id="d0be7-188">Opětovné školení modelů: přijímá identifikátor odběratele jako vstup a d vyvolá skript R na vývojovém serveru, aby znovu vyvolal model pro daného předplatitele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-188">Model re-training: accepts a subscriber identifier as input an,d invokes an R script on the development server to re-train the model for that subscriber.</span></span>

<span data-ttu-id="d0be7-189">Implementace jednotného přihlašování (SSO) s *Azure Active Directory* vypnula, aby byla větší než očekávaná výzva.</span><span class="sxs-lookup"><span data-stu-id="d0be7-189">Implementing single sign-on (SSO) with *Azure Active Directory* turned out to be more of a challenge than expected.</span></span> <span data-ttu-id="d0be7-190">Důvodem je architektura aplikace s jednou stránkou (SPA).</span><span class="sxs-lookup"><span data-stu-id="d0be7-190">This was due to the single page application (SPA) framework.</span></span> <span data-ttu-id="d0be7-191">Jedna konkrétní knihovna Azure Active Directory měla klíč pro úspěch: [reagovat-ADAL](https://github.com/salvoravida/react-adal).</span><span class="sxs-lookup"><span data-stu-id="d0be7-191">One specific Azure Active Directory library was key for success: [react-adal](https://github.com/salvoravida/react-adal).</span></span> <span data-ttu-id="d0be7-192">Následující odkazy vám poskytnou užitečné pokyny pro implementaci ověřování:</span><span class="sxs-lookup"><span data-stu-id="d0be7-192">The following references provided helpful guidance for implementing authentication:</span></span>

- [<span data-ttu-id="d0be7-193">Scénáře ověřování pro Azure AD</span><span class="sxs-lookup"><span data-stu-id="d0be7-193">Authentication Scenarios for Azure AD</span></span>](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios)
- [<span data-ttu-id="d0be7-194">Jedna stránka aplikace</span><span class="sxs-lookup"><span data-stu-id="d0be7-194">Single Page Application</span></span>](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#single-page-application-spa)

### <a name="development-vm-mls-930"></a><span data-ttu-id="d0be7-195">Virtuální počítač pro vývoj (MLS 9.3.0)</span><span class="sxs-lookup"><span data-stu-id="d0be7-195">Development VM (MLS 9.3.0)</span></span>

<span data-ttu-id="d0be7-196">Vývoj modelu hostovaného virtuálního počítače, školení a opětovné školení a nasazení modelu klasifikace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-196">The development VM hosted model development, training and re-training, and deployment of the classification model.</span></span> <span data-ttu-id="d0be7-197">Virtuální počítač Azure (DS13 v2) byl zřízený se systémem Linux/Ubuntu 16,10 a následující byly nainstalovány do základního virtuálního počítače:</span><span class="sxs-lookup"><span data-stu-id="d0be7-197">An Azure VM (DS13 V2) was provisioned with Linux/Ubuntu 16.10 and the following were installed to the base VM:</span></span>

- <span data-ttu-id="d0be7-198">Machine Learning Server 9.3.0 podle [pokynů, které](https://docs.microsoft.com/machine-learning-server/install/machine-learning-server-install)jsou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="d0be7-198">Machine Learning Server 9.3.0 using instructions available [here](https://docs.microsoft.com/machine-learning-server/install/machine-learning-server-install).</span></span> <span data-ttu-id="d0be7-199">Ujistěte se, že provedete kroky ověření instalace a ověříte instalaci.</span><span class="sxs-lookup"><span data-stu-id="d0be7-199">Be sure to run through the setup verification steps to confirm the installation.</span></span> <span data-ttu-id="d0be7-200">Protože se jednalo o vývojový virtuální počítač, oddíl '*Povolit nasazení webové služby a vzdálená připojení*' byl ignorován.</span><span class="sxs-lookup"><span data-stu-id="d0be7-200">Because this was the development VM, the section ‘*Enable web service deployment and remote connections*’ was disregarded.</span></span>
- <span data-ttu-id="d0be7-201">[Server RStudio](https://www.rstudio.com/products/rstudio/download-server/) (verze Open Source).</span><span class="sxs-lookup"><span data-stu-id="d0be7-201">[RStudio Server](https://www.rstudio.com/products/rstudio/download-server/) (Open Source Version).</span></span> <span data-ttu-id="d0be7-202">Dejte pozor, abyste znovu neinstalovali R/r-Base (dříve se nainstalovala s MLS 9.3.0).</span><span class="sxs-lookup"><span data-stu-id="d0be7-202">Be careful not to re-install R/r-base (it was installed previously with MLS 9.3.0).</span></span>  
- <span data-ttu-id="d0be7-203">[Přidejte skupinu zabezpečení sítě](https://docs.microsoft.com/azure/virtual-machines/windows/nsg-quickstart-portal) k virtuálnímu počítači, aby bylo možné povolit příchozí připojení přes port 8787 pro RStudio Server.</span><span class="sxs-lookup"><span data-stu-id="d0be7-203">[Add a network security group](https://docs.microsoft.com/azure/virtual-machines/windows/nsg-quickstart-portal) to the VM to allow for inbound connections over port 8787 for RStudio Server.</span></span>  
- <span data-ttu-id="d0be7-204">Ovladače ODBC pro zpracování komunikace mezi vývojovým virtuálním počítačem a Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="d0be7-204">ODBC drivers to handle the communication between the development VM and Azure SQL Database.</span></span> <span data-ttu-id="d0be7-205">Na virtuální počítač se nainstalovaly tyto ovladače ODBC:</span><span class="sxs-lookup"><span data-stu-id="d0be7-205">The following odbc drivers were installed on the VM:</span></span>  
- <span data-ttu-id="d0be7-206">[Ovladač ODBC pro SQL Server 17](https://www.microsoft.com/download/details.aspx?id=56567) kompatibilní se systémem Linux/Ubuntu 16,10</span><span class="sxs-lookup"><span data-stu-id="d0be7-206">The [ODBC Driver for SQL Server 17](https://www.microsoft.com/download/details.aspx?id=56567) compatible with Linux/ubuntu 16.10</span></span>  
- <span data-ttu-id="d0be7-207">Open source ovladač ODBC unixODBC s pokyny k instalaci z tématu [Import relačních dat pomocí rozhraní ODBC](https://docs.microsoft.com/machine-learning-server/r/how-to-revoscaler-data-odbc).</span><span class="sxs-lookup"><span data-stu-id="d0be7-207">An open source ODBC driver unixodbc with installation instructions from [Import relational data using ODBC](https://docs.microsoft.com/machine-learning-server/r/how-to-revoscaler-data-odbc).</span></span> <span data-ttu-id="d0be7-208">Poznámka: v tomto článku najdete dvě překlepy pro Ubuntu pokyny.</span><span class="sxs-lookup"><span data-stu-id="d0be7-208">Note: this article has two typos for Ubuntu instructions.</span></span>  
- <span data-ttu-id="d0be7-209">Chcete-li zjistit, zda je nainstalováno unixODBC: ````Apt list –installed | grep unixODBC (should be unixodbc)````</span><span class="sxs-lookup"><span data-stu-id="d0be7-209">To check if unixodbc is installed:       ````Apt list –installed | grep unixODBC (should be unixodbc)````</span></span>
      - <span data-ttu-id="d0be7-210">A nainstalujte ovladač: ````sudo apt-get install unixodbc-devel unixodbc-bin unixodbc (should be unixodbc-dev)````</span><span class="sxs-lookup"><span data-stu-id="d0be7-210">And to install the driver: ````sudo apt-get install unixodbc-devel unixodbc-bin unixodbc (should be unixodbc-dev)````</span></span>

### <a name="operations-vm-mls-930"></a><span data-ttu-id="d0be7-211">Provozní virtuální počítač (MLS 9.3.0)</span><span class="sxs-lookup"><span data-stu-id="d0be7-211">Operations VM (MLS 9.3.0)</span></span>

<span data-ttu-id="d0be7-212">Provozní virtuální počítač hostuje webové služby a koncové body modelu, uložil soubory Swagger a uložené serializované verze modelů klasifikace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-212">The operations VM hosted the model web services and endpoints, stored the Swagger files, and stored serialized versions of the classification models.</span></span> <span data-ttu-id="d0be7-213">Konfigurace je velmi podobná MLS vývojovému serveru.</span><span class="sxs-lookup"><span data-stu-id="d0be7-213">Configuration is very similar to the MLS development server.</span></span> <span data-ttu-id="d0be7-214">Je ale nakonfigurovaný pro provozuschopnost, což znamená, že jsou nainstalované webové služby potřebné k obsluze koncových bodů REST.</span><span class="sxs-lookup"><span data-stu-id="d0be7-214">However, it is configured for operationalization which means the web services necessary to serve the REST endpoints are installed.</span></span> <span data-ttu-id="d0be7-215">K nasazení provozního virtuálního počítače jsou k dispozici šablony ARM, které umožňují nasazení rychle.</span><span class="sxs-lookup"><span data-stu-id="d0be7-215">To deploy the operations VM, there are ARM templates that make deployment quick.</span></span> <span data-ttu-id="d0be7-216">Viz téma [konfigurace Microsoft Machine Learning Server 9,3 k analýze zprovoznění pomocí šablon ARM](https://blogs.msdn.microsoft.com/mlserver/2018/02/27/configuring-microsoft-machine-learning-server-9-3-to-operationalize-analytics-using-arm-templates/).</span><span class="sxs-lookup"><span data-stu-id="d0be7-216">See: [Configuring Microsoft Machine Learning Server 9.3 to Operationalize Analytics using ARM Templates](https://blogs.msdn.microsoft.com/mlserver/2018/02/27/configuring-microsoft-machine-learning-server-9-3-to-operationalize-analytics-using-arm-templates/).</span></span> <span data-ttu-id="d0be7-217">Pro náš projekt byla pomocí této [šablony ARM](https://github.com/Microsoft/microsoft-r/tree/master/mlserver-arm-templates/one-box-configuration/linux)nasazena *jedna box* konfigurace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-217">For our project, a *One-Box* configuration was deployed using this [ARM template](https://github.com/Microsoft/microsoft-r/tree/master/mlserver-arm-templates/one-box-configuration/linux).</span></span>  
<span data-ttu-id="d0be7-218">V takovém případě součásti serveru pro podporu kanálu modelu byly v provozu.</span><span class="sxs-lookup"><span data-stu-id="d0be7-218">With this, the server components to support the model pipeline were up and running.</span></span>

## <a name="model-implementation"></a><span data-ttu-id="d0be7-219">Implementace modelu</span><span class="sxs-lookup"><span data-stu-id="d0be7-219">Model implementation</span></span>

<span data-ttu-id="d0be7-220">Jedno klíčové rozhodnutí ovlivnilo finální návrh modelu pro tento projekt a bylo přesunuto na "velký model", nikoli na jeden model monolitické.</span><span class="sxs-lookup"><span data-stu-id="d0be7-220">One key decision influenced the final model design for this project and that was to move to a “many model” design rather than a single, monolithic model.</span></span> <span data-ttu-id="d0be7-221">Rozdíl: Každý předplatitel má svůj vlastní model klasifikace, nikoli jeden model klasifikace Big, který bude obsluhovat všechny předplatitele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-221">The difference: each subscriber has their own classification model rather than one big classification model to serve all subscribers.</span></span> <span data-ttu-id="d0be7-222">Pro tohoto zákazníka byl přístup preferovaný, protože menší model má menší nároky na paměť a bylo jednodušší ho horizontálně škálovat v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="d0be7-222">For this customer, the approach was preferred because a smaller model had a smaller memory footprint and was easier to scale horizontally in production.</span></span>

### <a name="data-import"></a><span data-ttu-id="d0be7-223">Import dat</span><span class="sxs-lookup"><span data-stu-id="d0be7-223">Data import</span></span>

<span data-ttu-id="d0be7-224">Všechna data potřebná pro vývoj modelu se nacházejí v *Azure SQL Database*.</span><span class="sxs-lookup"><span data-stu-id="d0be7-224">All the data needed for model development resided in an *Azure SQL Database*.</span></span> <span data-ttu-id="d0be7-225">Při výuce a školení modelů bylo provedeno import dat ve dvou fázích:</span><span class="sxs-lookup"><span data-stu-id="d0be7-225">For model training and retraining, data import was done in two stages:</span></span>

1. <span data-ttu-id="d0be7-226">Do databáze byl odeslán dotaz, který načte data pro konkrétní *subscriber_id* a vrácenou sadu výsledků.</span><span class="sxs-lookup"><span data-stu-id="d0be7-226">A query was submitted to the database to retrieve data for a specific *subscriber_id* and a result set returned.</span></span> <span data-ttu-id="d0be7-227">Pro dotaz na přístup k databázi byly zváženy dvě možnosti:</span><span class="sxs-lookup"><span data-stu-id="d0be7-227">Two options were considered for query access to the database:</span></span>

- <span data-ttu-id="d0be7-228">Funkce RevoScaleR s názvem [RxSQLServerData](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsqlserverdata)</span><span class="sxs-lookup"><span data-stu-id="d0be7-228">A RevoScaleR function called [RxSQLServerData](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsqlserverdata)</span></span>
- <span data-ttu-id="d0be7-229">Balíček R ODBC</span><span class="sxs-lookup"><span data-stu-id="d0be7-229">The R odbc package</span></span>

<span data-ttu-id="d0be7-230">Bylo rozhodnuto použít knihovnu R "ODBC", která povolila filtrování dat na úrovni databáze.</span><span class="sxs-lookup"><span data-stu-id="d0be7-230">It was decided to use the R “odbc” library which enabled data filtering at the database level.</span></span> <span data-ttu-id="d0be7-231">Filtrování tabulky databáze pouze pro řádky potřebné pro určitý model odběratele minimalizuje počet řádků, které mají být čteny do jazyka R a zpracovány.</span><span class="sxs-lookup"><span data-stu-id="d0be7-231">Filtering the database table for only the rows needed for a specific subscriber model minimized the number of rows to be read into R and processed.</span></span> <span data-ttu-id="d0be7-232">Tím se snížila paměť, výpočetní výkon a celková doba potřebná ke školení nebo přeškolování jednotlivých modelů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-232">That reduced the memory, compute, and overall time needed to train or retrain each model.</span></span>  

1. <span data-ttu-id="d0be7-233">Sada výsledků byla převedena na datový rámec R a některé z datových typů byly explicitně převedeny z varchars na celá čísla nebo číselné hodnoty podle požadavků klasifikačních algoritmů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-233">The result set was converted into an R data frame and some of the data types were explicitly converted from varchars to integers or numerics as required by the classification algorithms.</span></span> <span data-ttu-id="d0be7-234">Pro tuto funkci se použila funkce RevoScaleR [rxImport](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rximport) .</span><span class="sxs-lookup"><span data-stu-id="d0be7-234">For this functionality, the RevoScaleR function [rxImport](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rximport) was used.</span></span> <span data-ttu-id="d0be7-235">Funkce *rxImport* je rozčleněná s RevoScaleR a MicrosoftML a je navržena tak, aby byla Vícevláknová.</span><span class="sxs-lookup"><span data-stu-id="d0be7-235">The *rxImport* function is bundled with RevoScaleR and MicrosoftML and is engineered to be multi-threaded.</span></span> <span data-ttu-id="d0be7-236">Tady je příklad, jak jsme ho použili:</span><span class="sxs-lookup"><span data-stu-id="d0be7-236">Here is an example of how we used it:</span></span>

````r

# Populate the data frame and modify column types as needed
input_data <- rxImport(sqlServerDataDS, colClasses = c(  
Approved="integer",
      OnTimeArrivalRate="numeric",
      Amount="numeric",
      IsInformed="numeric",
      <continue with list of columns> )
# View the characteristics of the variables in the data source
rxGetInfo (input_data, getVarInfo = TRUE)
````

## <a name="unbalanced-data"></a><span data-ttu-id="d0be7-237">Nevyvážená data</span><span class="sxs-lookup"><span data-stu-id="d0be7-237">Unbalanced data</span></span>

<span data-ttu-id="d0be7-238">Vzhledem k tomu, že cílem modelu doporučení bylo předpovědi pravděpodobnosti, že zákazník obnoví kontrakt a rozdělí ho do kategorie Ano, ne nebo možná, byl použit algoritmus klasifikace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-238">Because the goal of the recommendation model was to forecast the probability a customer would renew a contract and categorize the probability it into a ‘yes’, ‘no’, or ‘maybe’, a classification algorithm was used.</span></span> <span data-ttu-id="d0be7-239">Jedním z problémů, které mohou vážně ovlivnit přesnost a výkon klasifikačního algoritmu, je nevyvážená datová sada.</span><span class="sxs-lookup"><span data-stu-id="d0be7-239">One problem that can seriously impact the accuracy and performance of a classification algorithm is an unbalanced data set.</span></span>  
<span data-ttu-id="d0be7-240">Pokud existuje mnoho dalších vzorků pro jednu třídu "Class" než jiné "Class", je datová sada nevyvážená.</span><span class="sxs-lookup"><span data-stu-id="d0be7-240">A data set is unbalanced if there are many more samples for one ‘class’ than another ‘class’.</span></span> <span data-ttu-id="d0be7-241">V takovém případě byl počet řádků dostupných pro každého předplatitele nevyvážený: na horním konci má jeden předplatitel 1 milion + řádků; na konci 330 zákazníci měli méně než 100 řádků dat.</span><span class="sxs-lookup"><span data-stu-id="d0be7-241">In this case, the number of rows available for each subscriber was unbalanced: on the high end, one subscriber had 1 million+ rows; on the low end, 330 customers had less than 100 rows of data.</span></span> <span data-ttu-id="d0be7-242">Následující graf ukazuje nevyrovnanost s počtem řádků (vzorků) na předplatiteli: ![nevyrovnanosti-Chart](assets/recommendation-engine-optimization/recommendaton_engine_chart.png)</span><span class="sxs-lookup"><span data-stu-id="d0be7-242">The graph below shows the imbalance with the number of rows (samples) per subscriber: ![imbalance-chart](assets/recommendation-engine-optimization/recommendaton_engine_chart.png)</span></span>

<span data-ttu-id="d0be7-243">Jedna z postupů pro zpracování nevyvážené datové sady je změnit sadu dat a buď převzorkovat v rámci předreprezentované třídy, nebo v části-Sample třídy, která je nadmnožinou.</span><span class="sxs-lookup"><span data-stu-id="d0be7-243">One technique for treating an unbalanced data set is to change the data set and either over-sample the under-represented class, or under-sample the over-represented class.</span></span> <span data-ttu-id="d0be7-244">Další technikou je syntetické generování dalších dat pomocí přesného vědomí dat a jejích atributů, které vlastní vlastník dat.</span><span class="sxs-lookup"><span data-stu-id="d0be7-244">Another technique is to synthetically generate additional data using the data owner’s exact knowledge of the data and its attributes.</span></span> <span data-ttu-id="d0be7-245">Zákazník vytvořil prahovou hodnotu pro minimální velikost vzorku odběratele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-245">The customer established a threshold for the minimum sample size for a subscriber.</span></span> <span data-ttu-id="d0be7-246">Pro předplatitele pod touto prahovou hodnotou by se musely zacházet s daty.</span><span class="sxs-lookup"><span data-stu-id="d0be7-246">For subscribers below that threshold, data would need to be treated.</span></span> <span data-ttu-id="d0be7-247">Pro tento projekt se prozkoumaly oba přístupy.</span><span class="sxs-lookup"><span data-stu-id="d0be7-247">For this project both approaches were explored.</span></span>

## <a name="algorithm-selection"></a><span data-ttu-id="d0be7-248">Výběr algoritmu</span><span class="sxs-lookup"><span data-stu-id="d0be7-248">Algorithm Selection</span></span>

<span data-ttu-id="d0be7-249">Byly vyhodnoceny tři různé implementace algoritmu klasifikace: *rxDForest*, *rxFastTrees*a *rxFastForest*.</span><span class="sxs-lookup"><span data-stu-id="d0be7-249">Three different classification algorithm implementations were evaluated: *rxDForest*, *rxFastTrees*, and *rxFastForest*.</span></span> <span data-ttu-id="d0be7-250">Všechny tři algoritmy využívají vícevláknové a paralelismuy.</span><span class="sxs-lookup"><span data-stu-id="d0be7-250">All three algorithms take advantage of multi-threading and parallelism.</span></span> <span data-ttu-id="d0be7-251">A Microsoft ML bude používat víc procesorů nebo GPU, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="d0be7-251">And Microsoft ML will use multiple CPUs or GPUs if available.</span></span> <span data-ttu-id="d0be7-252">Kritéria pro vyhodnocení modelů, které jsou součástí:</span><span class="sxs-lookup"><span data-stu-id="d0be7-252">The criteria for evaluating the models included:</span></span>

- <span data-ttu-id="d0be7-253">Byly nové modely přesnější, že původní model?</span><span class="sxs-lookup"><span data-stu-id="d0be7-253">Were the new models more accurate that the original model?</span></span>
- <span data-ttu-id="d0be7-254">Jaké jsou paměťové nároky na modely běžící v produkčním prostředí?</span><span class="sxs-lookup"><span data-stu-id="d0be7-254">What was the memory footprint of the models running in production?</span></span> <span data-ttu-id="d0be7-255">Bez narušení přesnosti by provozní prostředí podporovalo souběžné spouštění mnoha modelů s odezvou předpovědi prakticky v reálném čase?</span><span class="sxs-lookup"><span data-stu-id="d0be7-255">Without compromising accuracy, could the operational environment support simultaneous execution of many models with near real-time prediction response?</span></span>
- <span data-ttu-id="d0be7-256">Jak dobře měl algoritmus zpracovat nevyváženou datovou sadu?</span><span class="sxs-lookup"><span data-stu-id="d0be7-256">How well did the algorithm handle the unbalanced data set?</span></span> <span data-ttu-id="d0be7-257">Je nutné, aby nerovnováha byla předem ošetřena generováním syntetických dat?</span><span class="sxs-lookup"><span data-stu-id="d0be7-257">Would the imbalance need to be pre-treated by generating synthetic data?</span></span>

<span data-ttu-id="d0be7-258">Níže uvedená tabulka shrnuje závěry:</span><span class="sxs-lookup"><span data-stu-id="d0be7-258">The table below summarizes the findings:</span></span>

| <span data-ttu-id="d0be7-259">Algoritmus</span><span class="sxs-lookup"><span data-stu-id="d0be7-259">Algorithm</span></span> | <span data-ttu-id="d0be7-260">Popis</span><span class="sxs-lookup"><span data-stu-id="d0be7-260">Description</span></span> | <span data-ttu-id="d0be7-261">Zjištění</span><span class="sxs-lookup"><span data-stu-id="d0be7-261">Findings</span></span> | <span data-ttu-id="d0be7-262">Poznámky</span><span class="sxs-lookup"><span data-stu-id="d0be7-262">Notes</span></span> |
| :--------- | :------------ | :--------- | :--------------- |
| [<span data-ttu-id="d0be7-263">rxFastTrees</span><span class="sxs-lookup"><span data-stu-id="d0be7-263">rxFastTrees</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/microsoftml/rxfasttrees) | <span data-ttu-id="d0be7-264">Paralelní implementace zesíleného rozhodovacího stromu, který implementuje vícevláknovou verzi FastRank.</span><span class="sxs-lookup"><span data-stu-id="d0be7-264">Parallel implementation of boosted decision tree that implements multi-threaded version of FastRank.</span></span> | <span data-ttu-id="d0be7-265">Přesný a nejrychlejší výkon.</span><span class="sxs-lookup"><span data-stu-id="d0be7-265">Accurate, fastest performance.</span></span> | <span data-ttu-id="d0be7-266">Žádné speciální funkce pro nevyvážená data.</span><span class="sxs-lookup"><span data-stu-id="d0be7-266">No special features for unbalanced data.</span></span> <span data-ttu-id="d0be7-267">Předem zpracovaná data, která je třeba zadat jako vstup</span><span class="sxs-lookup"><span data-stu-id="d0be7-267">Pre-treated data needed to be provided as input</span></span> |
| [<span data-ttu-id="d0be7-268">rxFastForest</span><span class="sxs-lookup"><span data-stu-id="d0be7-268">rxFastForest</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/microsoftml/rxfastforest) | <span data-ttu-id="d0be7-269">Paralelní implementace náhodné doménové struktury a používá rxFastTrees k sestavování seznámení se kompletem rozhodovacích stromů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-269">Parallel implementation of random forest and uses rxFastTrees to build an ensemble learner of decision trees.</span></span> | <span data-ttu-id="d0be7-270">Lepší přesnost než původní s předem ošetřenými daty.</span><span class="sxs-lookup"><span data-stu-id="d0be7-270">Better accuracy than original with pre-treated data.</span></span> <span data-ttu-id="d0be7-271">Méně náročné na paměť, rychlejší než rxDForest</span><span class="sxs-lookup"><span data-stu-id="d0be7-271">Less memory intensive, faster than rxDForest</span></span> |<span data-ttu-id="d0be7-272">Žádné speciální funkce pro nevyvážená data.</span><span class="sxs-lookup"><span data-stu-id="d0be7-272">No special features for unbalanced data.</span></span> <span data-ttu-id="d0be7-273">Předem ošetřená data zadaná jako vstup.</span><span class="sxs-lookup"><span data-stu-id="d0be7-273">Pre-treated data provided as input.</span></span> |
| [<span data-ttu-id="d0be7-274">rxDForest</span><span class="sxs-lookup"><span data-stu-id="d0be7-274">rxDForest</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxdforest) | <span data-ttu-id="d0be7-275">Paralelní implementace náhodné doménové struktury.</span><span class="sxs-lookup"><span data-stu-id="d0be7-275">Parallel implementation of random forest.</span></span> <span data-ttu-id="d0be7-276">Zahrnuté v RevoScaleR.</span><span class="sxs-lookup"><span data-stu-id="d0be7-276">Included in RevoScaleR.</span></span> <span data-ttu-id="d0be7-277">Může se zabývat nevyváženými daty (odebrání chybějících dat, podmínek dat, zpracovávání rozdělení vzorků) všech uvnitř volání funkce.</span><span class="sxs-lookup"><span data-stu-id="d0be7-277">Can deal with unbalanced data (removes missing data, conditions data, handles stratification of samples) all within the function call.</span></span> | <span data-ttu-id="d0be7-278">Rychlejší než původní model.</span><span class="sxs-lookup"><span data-stu-id="d0be7-278">Faster than original model.</span></span> <span data-ttu-id="d0be7-279">Stejná nebo lepší přesnost než původní model.</span><span class="sxs-lookup"><span data-stu-id="d0be7-279">Same or better accuracy than original model.</span></span> <span data-ttu-id="d0be7-280">Zpracovává nevyváženou datovou sadu pomocí různých technik pro převzorkování a syntetizování.</span><span class="sxs-lookup"><span data-stu-id="d0be7-280">Handles unbalanced data set using a variety of techniques for re-sampling and synthesizing.</span></span> <span data-ttu-id="d0be7-281">Největší nároky na paměť</span><span class="sxs-lookup"><span data-stu-id="d0be7-281">Largest memory footprint.</span></span>  | <span data-ttu-id="d0be7-282">Největší nároky na paměť, protože zahrnují data s podmínkou v rámci funkce.</span><span class="sxs-lookup"><span data-stu-id="d0be7-282">Largest memory footprint because it includes the conditioned data within the function.</span></span>   <span data-ttu-id="d0be7-283">Zpracování dat je dobré, ale není tak dobré jako přizpůsobené transformace poskytnuté vlastníkem dat.</span><span class="sxs-lookup"><span data-stu-id="d0be7-283">Treatment of the data was good but not as good as the customized transformations provided by the data owner.</span></span> |

<span data-ttu-id="d0be7-284">Na konci zákazník vybral *rxFastForest* algoritmus a rozhodl se zacházet s nevyváženými daty pomocí knihovny [vtreat](https://cran.r-project.org/web/packages/vtreat/index.html) a přidat přizpůsobený krok předběžného zpracování dat do syntetického generování dat pro tyto předplatitele.</span><span class="sxs-lookup"><span data-stu-id="d0be7-284">In the end, the customer selected the *rxFastForest* algorithm and decided to treat the unbalanced data by using the [vtreat](https://cran.r-project.org/web/packages/vtreat/index.html) library and adding a customized data pre-processing step to synthetically generate data for the under-represented subscribers.</span></span>

## <a name="model-deployment--web-services"></a><span data-ttu-id="d0be7-285">Nasazení modelu & webové služby</span><span class="sxs-lookup"><span data-stu-id="d0be7-285">Model Deployment & Web Services</span></span>

<span data-ttu-id="d0be7-286">Publikování modelu pro nasazení na provozním virtuálním počítači je v této dokumentaci pro rychlý Start přímým předáním a popsáno v dokumentaci k [nasazení modelu R jako webové služby s mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/quickstart-publish-r-web-service).</span><span class="sxs-lookup"><span data-stu-id="d0be7-286">Publishing a model for deployment to the operations VM is straight-forward and documented in this QuickStart documentation [Deploy an R Model as a web service with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/quickstart-publish-r-web-service).</span></span>
<span data-ttu-id="d0be7-287">V našem scénáři byly po vytvoření modelů na vývojovém virtuálním počítači tyto modely publikovány na provozním VIRTUÁLNÍm počítači pomocí těchto kroků:</span><span class="sxs-lookup"><span data-stu-id="d0be7-287">In our scenario, once the models were created on the development VM, they were published on the operations VM using these steps:</span></span>

1. <span data-ttu-id="d0be7-288">Vytvořte vzdálené přihlášení z virtuálního počítače pro vývojáře k provoznímu virtuálnímu počítači pomocí jedné ze dvou funkcí dostupných v balíčku mrsdeploy pro ověřování. remoteLogin () pomocí místního jména správce a hesla nebo remoteLoginAAD () pomocí Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d0be7-288">Establish a remote login from the developer VM to the operations VM using one of two functions available in the mrsdeploy package for authentication; remoteLogin() using a local admin name and password, or remoteLoginAAD() using Azure Active Directory.</span></span> <span data-ttu-id="d0be7-289">Obě možnosti jsou popsány v této referenční příručce k Machine Learning Server nebo R Server pomocí mrsdeploy a otevření vzdálené relace.</span><span class="sxs-lookup"><span data-stu-id="d0be7-289">Both options are described in this reference Log in to Machine Learning Server or R Server with mrsdeploy and open a remote session.</span></span>  
2. <span data-ttu-id="d0be7-290">Jakmile je model vyškolen, publikujte ho na provozním virtuálním počítači pomocí funkcí publishService nebo operace updateservice v balíčku mrsdeploy.</span><span class="sxs-lookup"><span data-stu-id="d0be7-290">Once a model is trained, publish it to the operations VM using the publishService or updateService functions in the mrsdeploy package.</span></span> <span data-ttu-id="d0be7-291">Pro tento projekt jsme použili několik přístupů k nasazení a – v závislosti na přístupu – buď byl publikovaný nový model, nebo se aktualizoval existující model.</span><span class="sxs-lookup"><span data-stu-id="d0be7-291">For this project, we used multiple deployment approaches, and—depending on the approach—either a new model was published, or an existing model was updated.</span></span> <span data-ttu-id="d0be7-292">Následující kód byl implementován pro zpracování obou případů:</span><span class="sxs-lookup"><span data-stu-id="d0be7-292">The following code was implemented to handle both cases:</span></span>

````r
# If the service does not exist, publish it and if it does exist, update it.  
# No service by this name so publish one
 api <- publishService(serviceName, code =sc_predict, model = model,  
      inputs = list(prop_data="data.frame"),  
      outputs = list(answer = "numeric"), v = "v1.0.0" )
 print("=========== Model Created =============")
} else {
# A service by this name already exists, update it  
 api <- updateService(serviceName, model = model,
     inputs = list(prop_data="data.frame"), v = "v1.0.0" )
 print("=========== Model Updated =============")
}
 ````

Při nasazení jsou modely serializovány a uloženy na provozním serveru a lze je využívat prostřednictvím webových služeb v režimu *Standard* nebo v *reálném čase* . Pokaždé, když je webová služba volána se standardním režimem, R a všechny požadované knihovny jsou načteny a uvolněny při každém volání. Na rozdíl od režimu v *reálném čase* se R a knihovny načítají jenom jednou a znovu se používají pro další volání webové služby. Vzhledem k tomu, že většina režijních nákladů s voláním webové služby je načítání R a knihoven, nabízí režim v reálném čase mnohem nižší latenci pro model bodování a doba odezvy může být v rámci 10ms. V tématu dokumentace [a příklady odkazů si můžete](https://docs.microsoft.com/machine-learning-server/operationalize/concept-what-are-web-services) prohlédnout jak pro standard, tak pro možnosti v reálném čase. V reálném čase se sám hodí k jednomu předpovědi, ale můžete také předat vstupní datový rámec pro bodování. <span data-ttu-id="d0be7-299">To je popsané v tomto odkazu: [asynchronní spotřeba webových služeb prostřednictvím dávkového zpracování pomocí mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/how-to-consume-web-service-asynchronously-batch).</span><span class="sxs-lookup"><span data-stu-id="d0be7-299">That is described in this reference: [Asynchronous web service consumption via batch processing with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/how-to-consume-web-service-asynchronously-batch).</span></span>

## <a name="conclusion"></a><span data-ttu-id="d0be7-300">Závěr</span><span class="sxs-lookup"><span data-stu-id="d0be7-300">Conclusion</span></span>

<span data-ttu-id="d0be7-301">Využití paralelismu knihoven MicrosoftML a RevoScaleR integrovaných do Microsoft Machine Learning Server urychleného vývoje, nasazení a bodování jednotlivých modelů klasifikace pro stovky předplatitelů.</span><span class="sxs-lookup"><span data-stu-id="d0be7-301">Leveraging the parallelism of the MicrosoftML and RevoScaleR libraries built into Microsoft Machine Learning Server accelerated development, deployment, and scoring of individual classification models for hundreds of subscribers.</span></span> <span data-ttu-id="d0be7-302">Zlepšila se přesnost modelu a byly zkomprimovány školicí a školicí časy – to vše s minimálními změnami stávajícího základu kódu R.</span><span class="sxs-lookup"><span data-stu-id="d0be7-302">Model accuracy improved, and training and re-training times were compressed—all with minimal changes to the existing R code base.</span></span>
<span data-ttu-id="d0be7-303">Implementace infrastruktury pro podporu kanálu modelu a získání správně nakonfigurovaných technologických komponent může být komplexní.</span><span class="sxs-lookup"><span data-stu-id="d0be7-303">Implementing the infrastructure to support a model pipeline and getting the technology components configured correctly end-to-end can be complex.</span></span> <span data-ttu-id="d0be7-304">Tady jsou některé odkazy, které vám pomohou začít s vlastním přístupem:</span><span class="sxs-lookup"><span data-stu-id="d0be7-304">Here are some references to get your started with your own approach:</span></span>

- [<span data-ttu-id="d0be7-305">Dokumentace k Machine Learning Server</span><span class="sxs-lookup"><span data-stu-id="d0be7-305">Machine Learning Server Documentation</span></span>](https://docs.microsoft.com/machine-learning-server/)
- [<span data-ttu-id="d0be7-306">Kurzy R pro Machine Learning Server</span><span class="sxs-lookup"><span data-stu-id="d0be7-306">R Tutorials for Machine Learning Server</span></span>](https://docs.microsoft.com/advanced-analytics/tutorials/sql-server-r-tutorials?view=sql-server-2017)
- [<span data-ttu-id="d0be7-307">Ukázky R pro Machine Learning Server</span><span class="sxs-lookup"><span data-stu-id="d0be7-307">R Samples for Machine Learning Server</span></span>](https://docs.microsoft.com/machine-learning-server/r/r-samples)
- [<span data-ttu-id="d0be7-308">Referenční dokumentace knihovny funkcí jazyka R</span><span class="sxs-lookup"><span data-stu-id="d0be7-308">R Function Library Reference</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/introducing-r-server-r-package-reference)

## <a name="references"></a><span data-ttu-id="d0be7-309">Reference</span><span class="sxs-lookup"><span data-stu-id="d0be7-309">References</span></span>

<span data-ttu-id="d0be7-310">Pokud vás zajímá vytváření dalších prediktivních řešení pro maloobchodní firmu, přejděte do [části maloobchodní prodej](https://gallery.azure.ai/industries/retail) v [galerii Azure AI](https://gallery.azure.ai/).</span><span class="sxs-lookup"><span data-stu-id="d0be7-310">If you are interested in building other predictive solutions for your retail business, visit the [retail section](https://gallery.azure.ai/industries/retail) of the Azure [AI Gallery](https://gallery.azure.ai/).</span></span>  